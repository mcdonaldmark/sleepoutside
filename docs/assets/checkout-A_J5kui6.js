import{g as a,s as c,r as n,a as l,l as u,S as h,q as m}from"./ShoppingCart-ClDtzCIC.js";import{E as p}from"./ExternalServices-DglhzZ9G.js";const d=new p;function g(r){const o=new FormData(r),t={};return o.forEach(function(e,s){t[s]=e}),t}function S(r){return r.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}))}class T{constructor(o,t){this.key=o,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=a(this.key),this.calculateItemSummary()}calculateItemSummary(){const o=document.querySelector(this.outputSelector+" #cartTotal"),t=document.querySelector(this.outputSelector+" #num-items");t.innerText=this.list.length;const e=this.list.map(s=>s.FinalPrice);this.itemTotal=e.reduce((s,i)=>s+i),o.innerText="$"+this.itemTotal}calculateOrdertotal(){this.shipping=10+(this.list.length-1)*2,this.tax=(this.itemTotal*.06).toFixed(2),this.orderTotal=(parseFloat(this.itemTotal)+parseFloat(this.shipping)+parseFloat(this.tax)).toFixed(2),this.displayOrderTotals()}displayOrderTotals(){const o=document.querySelector(this.outputSelector+" #shipping"),t=document.querySelector(this.outputSelector+" #tax"),e=document.querySelector(this.outputSelector+" #orderTotal");o.innerText="$"+this.shipping,t.innerText="$"+this.tax,e.innerText="$"+this.orderTotal}async checkout(){const o=document.forms.checkout,t=g(o);t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=S(this.list),console.log(t);try{const e=await d.checkout(t);console.log(e),c("so-cart",[]),location.assign("/checkout/success.html")}catch(e){n();for(let s in e.message)l(e.message[s]);console.log(e)}}}u().then(()=>{const r=new h("so-cart",".product-list");function o(e,s){const i=m(".cart-count");i&&(i.textContent=s||0)}r.onChange(o),r.init();const t=new T("so-cart",".checkout-summary");t.init(),document.querySelector("#zip").addEventListener("blur",t.calculateOrdertotal.bind(t)),document.querySelector("#checkoutSubmit").addEventListener("click",e=>{e.preventDefault(),t.checkout()})});
